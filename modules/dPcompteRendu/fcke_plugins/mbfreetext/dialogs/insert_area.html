<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <style type="text/css">
    body, table {
        font: inherit;
    }
    </style>
  <script type="text/javascript" src="../../../../../lib/scriptaculous/lib/prototype.js"></script>
  <script type="text/javascript">
    var CKEDITOR = window.parent.parent.CKEDITOR;
    
    function insertSpecialChar(specialChar) { 
      var selection = CKEDITOR.instances.htmlarea.getSelection(), 
          ranges    = selection.getRanges(), 
          range, textNode;  
       
      for ( var i = 0, len = ranges.length ; i < len ; i++ ) { 
        range = ranges[ i ]; 
        range.deleteContents(); 
        textNode = CKEDITOR.dom.element.createFromHtml( specialChar ); 
        range.insertNode( textNode ); 
      } 
       
      range.moveToPosition( textNode, CKEDITOR.POSITION_AFTER_END ); 
      range.select(); 
    }


    function Ok(e) {
      var content = $('txtData').value;
        if (content != '') {
          var sHtml = "<span class='field'>[[Texte libre - " + content + "]]</span>&nbsp;";
          if (CKEDITOR.env.gecko) {
            insertSpecialChar(sHtml);
          } else {
            CKEDITOR.instances.htmlarea.insertHtml(sHtml);
          }
          CKEDITOR.instances.htmlarea.fire("key", []);
        }
        removeListeners();
        return true ;
    }
    
    function removeListeners() {
      CKEDITOR.dialog.getCurrent().removeListener("ok", Ok);
      CKEDITOR.dialog.getCurrent().removeListener("cancel", removeListeners);
    }
    
    window.onload = function () {
      document.getElementById("txtData").focus();
      CKEDITOR.dialog.getCurrent().on("ok", Ok);
      CKEDITOR.dialog.getCurrent().on("cancel", removeListeners);
    }

  </script>

</head>
<body style="overflow: hidden">
  <table cellspacing="0" cellpadding="0" width="100%" border="0">
    <tr>
      <td>
          Veuillez donner un nom à la zone de texte libre : <input id="txtData" type="text"/> <br />
      </td>
    </tr>
    <tr id="empty-name" style="display: none;">
      <td>
        <div style="font-weight: bold; color: #800;">Le nom doit contenir au moins un caractère</div>
      </td>
    </tr>
  </table>
</body>
</html>
